---
import Layout from "../layouts/Layout.astro";
import Header from "../components/Header-internal.astro";
import Footer from "../components/Footer.astro";
import CustomPhotoGrid from "../components/CustomPhotoGrid.astro";
import "../styles/global.css";

const { getCollection } = await import('astro:content');
const photoCollection = await getCollection('photos');
const photos = photoCollection
  .sort((a, b) => {
    // Extract numbers from slide IDs for proper sorting
    const aNum = parseInt(a.id.replace('slide', ''));
    const bNum = parseInt(b.id.replace('slide', ''));
    return aNum - bNum;
  })
  .map(photo => ({
    id: photo.id,
    title: photo.data.title,
    description: photo.data.description,
    coverImage: {
      src: photo.data.coverImage.src,
      alt: photo.data.coverImage.alt,
    },
    tags: photo.data.tags,
    publishDate: photo.data.publishDate,
    draft: photo.data.draft
  }));

// Create a simple serializable object for client-side JavaScript
const photosForJS = photoCollection
  .sort((a, b) => {
    const aNum = parseInt(a.id.replace('slide', ''));
    const bNum = parseInt(b.id.replace('slide', ''));
    return aNum - bNum;
  })
  .map(photo => ({
    id: photo.id,
    title: photo.data.title,
    description: photo.data.description,
    alt: photo.data.coverImage?.alt || photo.data.title
  }));
---

<Layout title="Restaurant | Foresters Arms Coverdale" description="Experience exceptional dining at The Foresters Arms restaurant in Carlton-in-Coverdale. Enjoy locally sourced Yorkshire cuisine, legendary ales, and warm hospitality in our historic Grade II listed pub.">
  <Header />

  <main>
    <!-- Restaurant Hero Section -->
    <section
      class="relative flex items-center justify-center min-h-screen pt-20 overflow-hidden bg-cover bg-center bg-no-repeat"
      style="background-image: url('/redesign/july2025/restaurant-header.webp');"
    >
      <div class="absolute inset-0 bg-black/20"></div>
      <div class="container relative z-10 px-6 mx-auto text-center">
        <h1
          class="mb-6 text-5xl font-black md:text-7xl font-display gold-accent animate-fadeInUp"
        >
          Exceptional Dining
        </h1>
        <p
          class="max-w-3xl mx-auto mb-10 text-xl text-gray-300 md:text-2xl animate-fadeInUp delay-1"
        >
          Savor the finest Yorkshire flavors in our historic setting, where every meal tells a story of local tradition and culinary excellence.
        </p>
        <a
          href="#menu"
          class="px-8 py-3 text-lg font-semibold text-black transition-all duration-300 transform rounded-lg bg-gold-accent hover-gold-accent hover:scale-105 animate-fadeInUp delay-2 focus:outline-none focus:ring-2 focus:ring-amber-300 focus:ring-opacity-50"
        >
          Explore Our Menu
        </a>
      </div>
    </section>

    <!-- Restaurant Philosophy Section -->
    <section class="py-20 bg-gray-900 md:py-32">
      <div class="container px-6 mx-auto">
        <div class="grid items-center gap-12 md:grid-cols-2">
          <div class="animate-fadeInUp">
            <h2 class="mb-6 text-4xl md:text-5xl font-display gold-accent">
              Our Culinary Philosophy
            </h2>
            <p class="mb-4 leading-relaxed text-gray-400">
              At The Foresters Arms, we believe in celebrating the rich culinary heritage of Yorkshire while embracing modern techniques and presentation. Our kitchen sources the finest local ingredients from trusted suppliers across the Dales.
            </p>
            <p class="mb-4 leading-relaxed text-gray-400">
              From hearty traditional dishes that warm the soul to contemporary creations that surprise and delight, every plate tells the story of our beautiful Yorkshire landscape and the passionate people who call it home.
            </p>
            <p class="leading-relaxed text-gray-400">
              Whether you're seeking a satisfying meal after a day exploring the Dales or celebrating a special occasion, our restaurant provides the perfect setting for memorable dining experiences.
            </p>
          </div>
          <div
            class="w-full bg-gray-800 rounded-lg shadow-xl overflow-hidden animate-fadeInUp delay-1"
          >
            <img
              src="/redesign/july2025/slow-cooked-beef.webp"
              alt="Beautifully presented local cuisine"
              class="w-full h-64 md:h-80 lg:h-96 object-cover"
            />
          </div>
        </div>
      </div>
    </section>

    <!-- Food & Drink Gallery Section -->
    <section id="gallery" class="py-20 bg-gray-800 md:py-32">
      <div class="container px-6 mx-auto">
        <h2 class="mb-16 text-4xl text-center md:text-5xl font-display gold-accent animate-fadeInUp">Our Food & Drink Gallery</h2>
        <CustomPhotoGrid photos={photos} columns={{ mobile: 2, tablet: 3, desktop: 4 }} class="mx-auto max-w-[1440px]" />
      </div>
    </section>

    <!-- Image Modal -->
    <div id="imageModal" class="fixed inset-0 z-50 bg-black bg-opacity-90 flex items-center justify-center p-4">
      <div class="relative max-w-4xl max-h-full">
        <button id="closeModal" class="absolute -top-12 right-0 text-white text-4xl hover:text-gold-accent transition-colors">
          ×
        </button>
        <img id="modalImage" src="" alt="" class="max-w-full max-h-full object-contain rounded-lg shadow-2xl" />
        <div id="modalInfo" class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black to-transparent p-6 text-white">
          <h3 id="modalTitle" class="text-xl font-display gold-accent mb-2"></h3>
          <p id="modalDescription" class="text-gray-300"></p>
        </div>
      </div>
    </div>


    <!-- Combined Menu & Dining Information Section -->
    <section id="menu" class="py-20 bg-black md:py-32">
      <div class="container px-6 mx-auto">
        <h2
          class="mb-16 text-4xl text-center md:text-5xl font-display gold-accent animate-fadeInUp"
        >
          Menu & Dining Information
        </h2>

        <div class="grid gap-12 lg:grid-cols-2">
          <!-- Left Column: Menu -->
          <div class="animate-fadeInUp delay-1">
            <h3 class="mb-8 text-3xl font-display gold-accent">Example Menu</h3>

            <!-- Menu Categories -->
            <div class="space-y-8 p-4 rounded-lg glassmorphic-card">
              <!-- Starters -->
              <div>
                <h4 class="pr-4 pl-4 mb-2 text-2xl font-display gold-accent">Starters</h4>
                <div class="">
                  <div class="pr-4 pl-4 pb-2">
                    <div class="flex justify-between">
                      <h5 class="text-lg font-semibold text-white">Potato & Watercress Soup</h5>
                      <span class="text-gold-accent font-semibold">£6</span>
                    </div>
                    <p class="text-gray-400 text-sm">A comforting classic soup made with fresh local ingredients</p>
                  </div>

                  <div class="pr-4 pl-4 pb-2">
                    <div class="flex justify-between">
                      <h5 class="text-lg font-semibold text-white">Wild Boar Terrine with Toast</h5>
                      <span class="text-gold-accent font-semibold">£7</span>
                    </div>
                    <p class="text-gray-400 text-sm">Served with toasted bread for a perfect starter</p>
                  </div>

                  <div class="pr-4 pl-4 pb-2">
                    <div class="flex justify-between">
                      <h5 class="text-lg font-semibold text-white">Smoked Mackerel Salad with Apple & Horseradish Cream</h5>
                      <span class="text-gold-accent font-semibold">£7</span>
                    </div>
                    <p class="text-gray-400 text-sm">Fresh salad with smoked fish and creamy horseradish</p>
                  </div>
                </div>
              </div>

              <!-- Main Courses -->
              <div>
                <h4 class="pr-4 pl-4 mb-2 text-2xl font-display gold-accent">Main Courses</h4>
                <div>
                  <div class="pr-4 pl-4 pb-2">
                    <div class="flex justify-between">
                      <h5 class="text-lg font-semibold text-white">10 Hour Slow Cooked Beef Short Rib (GF)</h5>
                      <span class="text-gold-accent font-semibold">£22</span>
                    </div>
                    <p class="text-gray-400 text-sm">Tender beef slow-cooked to perfection with Honey Glaze on a Celeriac Fondant</p>
                  </div>
                  <div class="pr-4 pl-4 pb-2">
                    <div class="flex justify-between">
                      <h5 class="text-lg font-semibold text-white">Pan Fried Pork Fillet with Sage &amp; Black Pepper Crumb (GFA)</h5>
                      <span class="text-gold-accent font-semibold">£18</span>
                    </div>
                    <p class="text-gray-400 text-sm">Served on a bed of mash with a white wine and mustard cream sauce</p>
                  </div>

                  <div class="pr-4 pl-4 pb-2">
                    <div class="flex justify-between">
                      <h5 class="text-lg font-semibold text-white">Pan Fried Chicken Breast </h5>
                      <span class="text-gold-accent font-semibold">£17</span>
                    </div>
                    <p class="text-gray-400 text-sm">Succulent chicken served with Creamy Mash & a Leek & Stilton Sauce</p>
                  </div>

                </div>
              </div>
              <div class="p-6 rounded-lg glassmorphic-card">
                <h4 class="mb-4 text-xl font-semibold text-white">Special Dietary Requirements</h4>
                <p class="text-gray-400">
                  We're happy to accommodate vegetarian, vegan, and gluten-free dietary requirements. Please let us know when booking so we can ensure our kitchen is prepared to create something special for you.
                </p>
              </div>
            </div>


          </div>

          <!-- Right Column: Hours and Reservations -->
          <div class="animate-fadeInUp delay-2">
            <!-- Opening Hours -->
            <h3 class="mb-8 text-3xl font-display gold-accent">Opening Times</h3>
            <div class="space-y-6">
              <div class="p-6 rounded-lg glassmorphic-card">
                <h4 class="mb-4 text-xl font-display gold-accent">Food Service Times:</h4>
                <ul class="space-y-2 text-gray-400">
                  <li class="flex justify-between">
                    <span>Monday:</span>
                    <span class="text-red-400">No food service</span>
                  </li>
                  <li class="flex justify-between">
                    <span>Tuesday - Wednesday:</span>
                    <span>5:00pm - 8:30pm</span>
                  </li>
                  <li class="flex justify-between">
                    <span>Thursday <span class="text-sm">(Ramsay's Fish & Chips van)</span>:</span>
                    <span>(6:30pm - 7:20pm)</span>
                  </li>
                  <li class="flex justify-between">
                    <span>Friday - Saturday:</span>
                    <span>12:00pm - 2:30pm & 5:00pm - 8:30pm</span>
                  </li>
                  <li class="flex justify-between">
                    <span>Sunday:</span>
                    <span>12:00pm - 4:00pm</span>
                  </li>
                </ul>
              </div>

              <div class="p-6 rounded-lg glassmorphic-card">
                <h4 class="mb-4 text-xl font-display gold-accent">Bar Hours:</h4>
                <ul class="space-y-2 text-gray-400">
                  <li class="flex justify-between">
                    <span>Monday - Thursday:</span>
                    <span>5:00pm - Late</span>
                  </li>
                  <li class="flex justify-between">
                    <span>Friday - Sunday:</span>
                    <span>12:00pm - Late</span>
                  </li>
                </ul>
              </div>
            </div>

            <div class="space-y-6">
              <div class="p-6 rounded-lg glassmorphic-card">
                <h4 class="mb-4 text-xl font-semibold text-white">Book Your Table</h4>
                <p class="mb-4 text-gray-400">
                  We recommend booking in advance, especially for weekend dining and Sunday lunch. Walk-ins are welcome subject to availability.
                </p>
                <div class="space-y-3">
                  <div class="flex items-center">
                    <span class="mr-3 gold-accent">📞</span>
                    <a href="tel:01969640272" class="text-white hover:text-gold-accent transition-colors">
                      01969 640272
                    </a>
                  </div>
                  <div class="flex items-center">
                    <span class="mr-3 gold-accent">✉️</span>
                    <a href="mailto:enquiries@forestersarmscoverdale.com" class="text-white hover:text-gold-accent transition-colors">
                      enquiries@forestersarmscoverdale.com
                    </a>
                  </div>
                </div>
              </div>


            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Call to Action Section -->
    <section class="py-20 bg-gray-900 md:py-32">
      <div class="container px-6 mx-auto text-center">
        <h2 class="mb-6 text-4xl font-display gold-accent animate-fadeInUp">
          Ready to Dine With Us?
        </h2>
        <p class="max-w-2xl mx-auto mb-8 text-xl text-gray-400 animate-fadeInUp delay-1">
          Experience the finest Yorkshire hospitality and cuisine in our historic setting. Book your table today or simply drop by for a drink at the bar.
        </p>
        <div class="flex flex-col sm:flex-row gap-4 justify-center animate-fadeInUp delay-2">
          <a
            href="tel:01969640272"
            class="px-8 py-3 text-lg font-semibold text-black transition-all duration-300 transform rounded-lg bg-gold-accent hover-gold-accent hover:scale-105 focus:outline-none focus:ring-2 focus:ring-amber-300 focus:ring-opacity-50"
          >
            Call to Book
          </a>
          <a
            href="mailto:enquiries@forestersarmscoverdale.com"
            class="px-8 py-3 text-lg font-semibold transition-all duration-300 transform rounded-lg border-2 border-gold-accent gold-accent hover:bg-gold-accent hover:text-black focus:outline-none focus:ring-2 focus:ring-amber-300 focus:ring-opacity-50"
          >
            Email Us
          </a>
        </div>
      </div>
    </section>
  </main>

  <Footer />

  <style>
    @media (min-width: 1080px) {
      section > .container {
        max-width: 80%;
        margin: 0 auto;
      }
    }
  </style>

  <script>
    // Photo data dynamically loaded from the .md files
    const photosData = [
      {id: "slide1", title: "This is some kind of pork dish", description: "This is some kind of pork dish", alt: "This is some kind of pork dish"},
      {id: "slide2", title: "This is Gallery image 2", description: "This is the second image in the gallery", alt: "This is Gallery image 2"},
      {id: "slide3", title: "This is Gallery image 3", description: "This is Gallery image 3", alt: "This is Gallery image 3"},
      {id: "slide4", title: "This is Gallery image 4", description: "This is Gallery image 4", alt: "This is Gallery image 4"},
      {id: "slide5", title: "This is Gallery image 5", description: "This is Gallery image 5", alt: "This is Gallery image 5"},
      {id: "slide6", title: "This is Gallery image 6", description: "This is Gallery image 6", alt: "This is Gallery image 6"},
      {id: "slide7", title: "This is Gallery image 7", description: "This is Gallery image 7", alt: "This is Gallery image 7"},
      {id: "slide8", title: "This is Gallery image 8", description: "This is Gallery image 8", alt: "This is Gallery image 8"},
      {id: "slide9", title: "This is Gallery image 9", description: "This is Gallery image 9", alt: "This is Gallery image 9"},
      {id: "slide10", title: "This is Gallery image 10", description: "This is Gallery image 10", alt: "This is Gallery image 10"},
      {id: "slide11", title: "This is Gallery image 11", description: "This is Gallery image 11", alt: "This is Gallery image 11"},
      {id: "slide12", title: "This is Gallery image 12", description: "This is Gallery image 12", alt: "This is Gallery image 12"},
      {id: "slide13", title: "This is Gallery image 13", description: "This is Gallery image 13", alt: "This is Gallery image 13"},
      {id: "slide14", title: "This is Gallery image 14", description: "This is Gallery image 14", alt: "This is Gallery image 14"},
      {id: "slide15", title: "This is Gallery image 15", description: "This is Gallery image 15", alt: "This is Gallery image 15"},
      {id: "slide16", title: "This is Gallery image 16", description: "This is Gallery image 16", alt: "This is Gallery image 16"}
    ];
    console.log('Script loaded, photosData:', photosData);

    document.addEventListener('DOMContentLoaded', function() {
      console.log('DOM loaded');
      const modal = document.getElementById('imageModal');
      const modalImage = document.getElementById('modalImage');
      const modalTitle = document.getElementById('modalTitle');
      const modalDescription = document.getElementById('modalDescription');
      const closeModal = document.getElementById('closeModal');

      console.log('Modal elements:', { modal, modalImage, modalTitle, modalDescription, closeModal });

      // Function to open modal
      function openModal(imageSrc, title, description) {
        console.log('Opening modal with:', { imageSrc, title, description });
        if (modalImage instanceof HTMLImageElement) {
          modalImage.src = imageSrc;
          modalImage.alt = title;
        }
        modalTitle.textContent = title;
        modalDescription.textContent = description;
        modal.classList.remove('hidden');
        document.body.style.overflow = 'hidden';
      }

      // Function to close modal
      function closeModalFunc() {
        console.log('Closing modal');
        modal.classList.add('hidden');
        document.body.style.overflow = 'auto';
      }

      // Close modal when clicking the X button
      closeModal.addEventListener('click', closeModalFunc);

      // Close modal when clicking outside the image
      modal.addEventListener('click', function(e) {
        if (e.target === modal) {
          closeModalFunc();
        }
      });

      // Close modal with Escape key
      document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape' && !modal.classList.contains('hidden')) {
          closeModalFunc();
        }
      });

      // Function to setup gallery links
      function setupGalleryLinks() {
        console.log('Setting up gallery links...');
        const galleryLinks = document.querySelectorAll('a[href*="/photos/"]');
        console.log('Found gallery links:', galleryLinks.length);

        galleryLinks.forEach((link, index) => {
          const anchorLink = link as HTMLAnchorElement;
          console.log('Setting up link', index, ':', anchorLink.href);
          anchorLink.addEventListener('click', function(e) {
            console.log('Gallery link clicked:', this.href);
            e.preventDefault();

            // Extract slide number from the href
            const href = this.getAttribute('href');
            console.log('Href:', href);
            const slideMatch = href.match(/slide(\d+)/);
            console.log('Slide match:', slideMatch);

            if (slideMatch) {
              const slideNumber = slideMatch[1];
              console.log('Slide number:', slideNumber);
              const largeImageSrc = '/redesign/july2025/gallery/slide' + slideNumber + '-large.webp';

              // Find the corresponding photo data from the actual slide.md files
              const slideId = 'slide' + slideNumber;
              console.log('Looking for slideId:', slideId);
              console.log('Available photosData:', photosData);
              console.log('PhotosData length:', photosData.length);
              console.log('PhotosData IDs:', photosData.map(p => p.id));

              const photoData = photosData.find(photo => photo.id === slideId);
              console.log('Found photoData:', photoData);

              const title = photoData ? photoData.title : 'Gallery Image ' + slideNumber;
              const description = photoData ? photoData.description : 'A beautiful image from our restaurant gallery';

              console.log('Using title:', title);
              console.log('Using description:', description);

              openModal(largeImageSrc, title, description);
            } else {
              console.log('No slide match found for href:', href);
            }
          });
        });
      }

      // Try multiple times to setup gallery links
      setTimeout(setupGalleryLinks, 100);
      setTimeout(setupGalleryLinks, 500);
      setTimeout(setupGalleryLinks, 1000);
      setTimeout(setupGalleryLinks, 2000);
    });
  </script>
</Layout>