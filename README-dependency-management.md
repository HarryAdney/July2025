# Dependency Management Guide

## Important: About package-lock.json

**⚠️ NEVER manually edit package-lock.json!** This file is automatically generated by npm and should only be modified by npm commands. Manual edits can cause:
- Inconsistent installations across environments
- Security vulnerabilities
- Build failures
- Dependency resolution conflicts

## Current Project Analysis

Your Astro project has a clean, minimal dependency structure:

### Production Dependencies
- **Astro 5.13.2** - Latest stable version ✅
- **Tailwind CSS 3.4.13** - Current version ✅
- **@astrojs/tailwind 6.0.2** - Astro Tailwind integration ✅

### Development Dependencies
- **TypeScript 5.6.3** - Latest version ✅
- **@astrojs/check 0.9.4** - Type checking ✅

## Recommended Improvements

### 1. Performance Optimizations

```bash
# Add image optimization
npm install sharp

# Add sitemap generation
npm install @astrojs/sitemap

# Add compression
npm install @astrojs/compress
```

### 2. Development Experience

```bash
# Add bundle analysis
npm install -D @astrojs/bundle-analyzer

# Add prefetching for better UX
npm install @astrojs/prefetch
```

### 3. Enhanced Scripts

Update your `package.json` scripts section:

```json
{
  "scripts": {
    "dev": "astro dev",
    "start": "astro dev",
    "build": "astro check && astro build",
    "preview": "astro preview",
    "preview:network": "astro preview --host",
    "check": "astro check",
    "type-check": "tsc --noEmit",
    "clean": "rm -rf dist .astro node_modules/.astro",
    "deps:check": "node scripts/dependency-check.js",
    "deps:optimize": "node scripts/optimize-dependencies.js",
    "update:safe": "npm update",
    "audit:fix": "npm audit fix"
  }
}
```

## Security Best Practices

### 1. Regular Audits
```bash
# Check for vulnerabilities
npm audit

# Fix automatically fixable issues
npm audit fix

# For manual review of high-severity issues
npm audit fix --force
```

### 2. Keep Dependencies Updated
```bash
# Check for outdated packages
npm outdated

# Update to latest compatible versions
npm update

# Update to latest major versions (review breaking changes first)
npm install package@latest
```

### 3. Use Exact Versions for Critical Dependencies
For production applications, consider using exact versions:

```json
{
  "dependencies": {
    "astro": "5.13.2",
    "tailwindcss": "3.4.13"
  }
}
```

## Bundle Size Optimization

### 1. Analyze Bundle Size
```bash
# Build and analyze
npm run build
npx astro build --analyze
```

### 2. Tree Shaking
Astro automatically tree-shakes unused code, but ensure you're importing only what you need:

```javascript
// ❌ Imports entire library
import _ from 'lodash';

// ✅ Import only what you need
import { debounce } from 'lodash-es';
```

### 3. Dynamic Imports
Use dynamic imports for code that's not immediately needed:

```javascript
// ❌ Static import
import { heavyLibrary } from 'heavy-library';

// ✅ Dynamic import
const { heavyLibrary } = await import('heavy-library');
```

## Maintenance Schedule

### Weekly
- [ ] Run `npm audit` to check for security issues
- [ ] Review and update patch versions with `npm update`

### Monthly
- [ ] Check for outdated packages with `npm outdated`
- [ ] Review and update minor versions
- [ ] Run dependency health check script

### Quarterly
- [ ] Review major version updates
- [ ] Analyze bundle size and performance
- [ ] Clean up unused dependencies
- [ ] Update Node.js version if needed

## Troubleshooting

### Common Issues

1. **Lock file conflicts**
   ```bash
   rm package-lock.json node_modules -rf
   npm install
   ```

2. **Peer dependency warnings**
   ```bash
   npm install --legacy-peer-deps
   ```

3. **Cache issues**
   ```bash
   npm cache clean --force
   ```

### Emergency Recovery
If your dependencies are completely broken:

```bash
# Nuclear option - start fresh
rm -rf node_modules package-lock.json
npm install
```

## Tools and Scripts

### Available Scripts
- `node scripts/dependency-check.js` - Health check for dependencies
- `node scripts/optimize-dependencies.js` - Optimization suggestions

### Recommended Tools
- **npm-check-updates** - Interactive dependency updates
- **depcheck** - Find unused dependencies
- **bundlephobia** - Analyze package sizes before installing

## Best Practices Summary

1. ✅ **DO**: Keep dependencies minimal and up-to-date
2. ✅ **DO**: Use exact versions for critical dependencies
3. ✅ **DO**: Regular security audits
4. ✅ **DO**: Use lock files in version control
5. ❌ **DON'T**: Edit package-lock.json manually
6. ❌ **DON'T**: Commit node_modules to version control
7. ❌ **DON'T**: Use `npm install --force` unless absolutely necessary
8. ❌ **DON'T**: Install packages globally unless required

## Performance Monitoring

Monitor your bundle size and performance:
- Use Lighthouse for performance audits
- Monitor Core Web Vitals
- Track bundle size changes in CI/CD
- Use performance budgets

Remember: The best dependency is no dependency. Always evaluate if you really need a package before adding it to your project.